<HTMLQuestion xmlns="http://mechanicalturk.amazonaws.com/AWSMechanicalTurkDataSchemas/2011-11-11/HTMLQuestion.xsd">
  <HTMLContent><![CDATA[
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>

    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script type='text/javascript' src='https://s3.amazonaws.com/mturk-public/externalHIT_v1.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <style>
        img {
            max-width: 100%;
            max-height: 100%;
        }

        .my-container {
            padding: 2em;
        }

        .response-box {
            margin-left: 1em;
            margin-right: 1em;
            margin-top: 2em;
            padding: 1em;
            border: 3px solid dodgerblue;
            border-radius: 5px;
        }

        .checkboxes {
            justify-content: center;
        }

        .my-checkbox {
            display: flex;
            align-items: center;
            flex-flow: column wrap;
        }

        body {
            background: white;
        }

        /* HIDE RADIO */
        [type=radio] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* IMAGE STYLES */
        [type=radio] + img {
            cursor: pointer;
        }

        /* CHECKED STYLES */
        [type=radio]:checked + img {
            outline: 5px solid dodgerblue;
            -moz-outline-radius: 5px;
        }

        .question-container {
            border: 1px solid lightskyblue;
            border-radius: 10px;
            padding: 2em;
            margin-bottom: 1em;
        }

        .image-comparison {
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
<!--  <form name='mturk_form' method='post' id='mturk_form' action='https://www.mturk.com/mturk/externalSubmit'>-->
<!--  <input type='hidden' value='' name='assignmentId' id='assignmentId'/>-->
<!--  <h1>This is a test question</h1>-->
<!--  <p><textarea name='comment' cols='80' rows='3'></textarea></p>-->
<!--  <p><input type='submit' id='submitButton' value='Submit' /></p></form>-->
<!--  <script language='Javascript'>turkSetAssignmentID();</script>-->
<div class="my-container" id="app">
    <div class="">

        <div class="question-container" v-for="comparison in comparisons">

            <h2>Comparison {{comparison.index}}</h2>
            <div class="mt-2 mb-2">
                <span>Which plot is better?</span>

            </div>

            <div class="image-comparison row">
                <label class="col-6 align-self-center" @click="select_comparison(comparison, 'left')">
                    <input type="radio" :name="comparison.index" value="small">
                    <img :src="comparison.first_plot_url">
                </label>
                <label class="col-6 align-self-center" @click="select_comparison(comparison, 'right')">
                    <input type="radio" :name="comparison.index" value="small">
                    <img :src="comparison.second_plot_url">
                </label>
            </div>
            <div v-if="!comparison.validation.plot_selected" class="mt-1 mb-1 error">
                Please select a plot.
            </div>

            <div class="mt-2 mb-2">
                <span class="mt-2 mb-2">What did you consider when making this decision?</span>
            </div>
            <div class="response-box">
                <div class="category-names row text-center">
                    <span class="col-2"></span>
                    <span class="col">Legend</span>
                    <span class="col">Colour</span>
                    <span class="col">Axes</span>
                    <span class="col">Element sizes</span>
                    <span class="col">Transparency</span>
                </div>

                <div class="checkboxes row text-center mt-2">
                    <span class="col-2">Left plot</span>
                    <div class="form-check col-2 my-checkbox">
                        <input class="form-check-input text-center" type="checkbox"
                               v-model="comparison.data.checkboxes.first.legend" id="left_legend"
                               @click="comparison.data.checkboxes.second.legend = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.first.colour" id="left_colour"
                               @click="comparison.data.checkboxes.second.colour = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox" v-model="comparison.data.checkboxes.first.axes"
                               id="left_axes"
                               @click="comparison.data.checkboxes.second.axes = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.first.element_sizes" id="left_element_sizes"
                               @click="comparison.data.checkboxes.second.element_sizes = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.first.transparency" id="left_transparency"
                               @click="comparison.data.checkboxes.second.transparency = false; comparison.validation.decision_selected = true;">
                    </div>
                </div>

                <div class="checkboxes row text-center mt-2">
                    <span class="col-2">Right plot</span>
                    <div class="form-check col-2 my-checkbox">
                        <input class="form-check-input text-center" type="checkbox"
                               v-model="comparison.data.checkboxes.second.legend" id="right_legend"
                               @click="comparison.data.checkboxes.first.legend = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.second.colour" id="right_colour"
                               @click="comparison.data.checkboxes.first.colour = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox" v-model="comparison.data.checkboxes.second.axes"
                               id="right_axes"
                               @click="comparison.data.checkboxes.first.axes = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.second.element_sizes" id="right_element_sizes"
                               @click="comparison.data.checkboxes.first.element_sizes = false; comparison.validation.decision_selected = true;">
                    </div>
                    <div class="form-check col my-checkbox">
                        <input class="form-check-input" type="checkbox"
                               v-model="comparison.data.checkboxes.second.transparency" id="right_transparency"
                               @click="comparison.data.checkboxes.first.transparency = false; comparison.validation.decision_selected = true;">
                    </div>
                </div>
            </div>
            <div v-if="!comparison.validation.decision_selected" class="mt-1 mb-1 error">
                Please select atleast one consideration.
            </div>
        </div>

        <span class="mt-1">Please leave any comments, feedback or problems you had with this task and help us improve it. Thank you!</span>
        <div class="mt-2 mb-2">
            <textarea v-model="feedback_message" placeholder="And comments, feedback, problems..." style="width: 50%; height: 10em;"></textarea>
        </div>

        <div v-if="error_submitting" class="mt-2 mb-2 error">
            Some of the comparisons are not completed. Please check for error messages and fill in the required fields.
        </div>
        <button @click="handleFormSubmit()" type="button" class="btn btn-primary">Submit</button>
        <!--TODO: Change action URL when pushing to production!-->
        <form method='post' id='mturk_form' action='https://workersandbox.mturk.com/mturk/externalSubmit'>
            <input type="hidden" id="inputData" name="data">
            <input type="hidden" id="inputFeedback" name="feedback">
            <input type="hidden" id="inputAssignmentId" name="assignmentId">
        </form>
    </div>
</div>
<script>
    var app = new Vue({
            el: '#app',
            data: function () {
                return {
                    error_submitting: false,
                    feedback_message: "",
                    comparisons: "${plot_comparisons}"
                        .split("\t")
                        .map(x => x.split(";").map(el => el.trim()))
                        .map(function (comparison, index) {
                            return {
                                index: index + 1,
                                first_plot_url: comparison[0],
                                second_plot_url: comparison[1],
                                data: {
                                    selected_plot: null,
                                    checkboxes: {
                                        first: {
                                            legend: false,
                                            colour: false,
                                            axes: false,
                                            element_sizes: false,
                                            transparency: false
                                        },
                                        second: {
                                            legend: false,
                                            colour: false,
                                            axes: false,
                                            element_sizes: false,
                                            transparency: false
                                        }
                                    }
                                },
                                validation: {
                                    plot_selected: true,
                                    decision_selected: true
                                }
                            }
                        })
                }
            },
            methods: {
                validate() {
                    this.comparisons = this.comparisons.map(function (val) {
                        val.validation.plot_selected = val.data.selected_plot != null
                        val.validation.decision_selected = Object.values(val.data.checkboxes.first).some(el => el) || Object.values(val.data.checkboxes.second).some(el => el)
                        return val
                    })

                    valid = this.comparisons.map(el => el.validation.plot_selected).every(el => el) && this.comparisons.map(el => el.validation.decision_selected).every(el => el)
                    return valid
                },
                select_comparison(comparison, plot) {
                    comparison.data.selected_plot = plot
                    comparison.validation.plot_selected = true
                },
                handleFormSubmit() {
                    this.error_submitting = false
                    if (!this.validate()) {
                        this.error_submitting = true
                        return
                    }

                    const data = this.comparisons.map(el => {
                        return el.data
                    })

                    const urlParams = new URLSearchParams(window.location.search)
                    document.getElementById('inputAssignmentId').value = urlParams.get('assignmentId')
                    document.getElementById('inputData').value = JSON.stringify(data)
                    document.getElementById('inputFeedback').value = JSON.stringify(this.feedback_message)
                    document.getElementById('mturk_form').submit()
                }
            }
        }
    )
</script>
</body>
</html>
]]>
  </HTMLContent>
  <FrameHeight>0</FrameHeight>
</HTMLQuestion>